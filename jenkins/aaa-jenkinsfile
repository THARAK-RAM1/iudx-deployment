pipeline {
        agent {
    node {
      label 'slave1'
    }
  }
  stages {
      stage('publishing report'){
          steps {
              script{
               sh 'helm template -f K8s-deployment/Charts/auth-server/values.yaml -f K8s-deployment/Charts/auth-server/example-azure-resource-values.yaml K8s-deployment/Charts/auth-server  > auth-server.yaml'
               sh 'kubescape scan auth-server.yaml --format junit --output auth-report.xml'
               xunit (
                thresholds: [ skipped(failureThreshold: '1'), failed(failureThreshold: '0') ],
                tools: [ JUnit(pattern: '/var/lib/jenkins/workspace/kubescape-auth/auth-report.xml') ]
              )              }
          }
      }
  }
}
